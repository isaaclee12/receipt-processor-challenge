# Instructions for Running
1. This is unlikely, but if migrations need to be made for any reason, run the following commands:
- `python manage.py makemigrations receipt_processor`
- `python manage.py migrate receipt_processor`

2. If you'd like, run the test suite:
- `python manage.py test receipt_processor.tests`

3. Spin up and run the docker container by running:
- `docker compose up -d`
- NOTE: On a mac running on an ARM64 chip, you may have to run this instead: `docker-compose up -d`

4. Using software like [Postman](https://www.postman.com/) (or whatever you decide to use), you can manually test the endpoints at the following URLs:
  - Process Receipts: http://localhost:8000/receipts/process
  - Get Points: http://localhost:8000/receipts/{receipt_id}/points/


# Decisions
- I decided to use Docker for this project, as it is the backend framework that I am most familiar with. On a more fundamental level, I'm very skilled in crafting smooth and efficient APIs for my clients and peers, and I'm positive these skills would translate well to working with Go at Fetch.
- I created my own test suite to ensure that my code ran as specified in this README. In doing so, I discovered that my code did not work as intended, as I was only creating one Item object for repeat objects on a Receipt. Writing my own tests allowed me to catch something that may have led to poor marks on this challenge.

# Room for Improvement
- Ideally, I would want to add better security and authentication. The permission_classes in views.py are far from ideal, and there are openly exposed secret keys in settings.py (which should be stored somewhere private). As this is just a coding challenge, I'm willing to let it slide. Though generally I err on the side of heightened caution with cybersecurity.
- I implemented a Many-To-Many relationship between Items and Receipts using an intermediary model, ItemAssignmentToReceipt. This allowed me to freely store purchased items and assign them to different receipts. In reality, I would want a second opinion on this data design, as I know bad data design can turn into very bad tech debt down the road.

# Receipt Processor

A web service that fulfills the documented API. The API is described below. A formal definition is provided 
in the [api.yml](./api.yml) file.

Data is persisted in the `db.sqlite3` file. This can be accessed using the db.sqlite3 extension in VScode, or using software
such as https://sqlitebrowser.org/

## Language Selection

As I am not using Go, I have included a Dockerized setup to run the code. See the instructions above for spinning up and running the Docker container for this project.

## Submitting Your Solution

Provide a link to a public repository, such as GitHub or BitBucket, that contains your code to the provided link through Greenhouse.

---
## Summary of API Specification

### Endpoint: Process Receipts

* Path: `/receipts/process`
* Method: `POST`
* Payload: Receipt JSON
* Response: JSON containing an id for the receipt.

Description:

Takes in a JSON receipt (see example in the example directory) and returns a JSON object with an ID generated by your code.

The ID returned is the ID that should be passed into `/receipts/{id}/points` to get the number of points the receipt
was awarded.

How many points should be earned are defined by the rules below.

Reminder: Data does not need to survive an application restart. This is to allow you to use in-memory solutions to track any data generated by this endpoint.

Example Response:
```json
{ "id": "7fb1377b-b223-49d9-a31a-5a02701dd310" }
```

## Endpoint: Get Points

* Path: `/receipts/{id}/points`
* Method: `GET`
* Response: A JSON object containing the number of points awarded.

A simple Getter endpoint that looks up the receipt by the ID and returns an object specifying the points awarded.

Example Response:
```json
{ "points": 32 }
```

---

# Rules

These rules collectively define how many points should be awarded to a receipt.

* One point for every alphanumeric character in the retailer name.
* 50 points if the total is a round dollar amount with no cents.
* 25 points if the total is a multiple of `0.25`.
* 5 points for every two items on the receipt.
* If the trimmed length of the item description is a multiple of 3, multiply the price by `0.2` and round up to the nearest integer. The result is the number of points earned.
* 6 points if the day in the purchase date is odd.
* 10 points if the time of purchase is after 2:00pm and before 4:00pm.


## Examples

```json
{
  "retailer": "Target",
  "purchaseDate": "2022-01-01",
  "purchaseTime": "13:01",
  "items": [
    {
      "shortDescription": "Mountain Dew 12PK",
      "price": "6.49"
    },{
      "shortDescription": "Emils Cheese Pizza",
      "price": "12.25"
    },{
      "shortDescription": "Knorr Creamy Chicken",
      "price": "1.26"
    },{
      "shortDescription": "Doritos Nacho Cheese",
      "price": "3.35"
    },{
      "shortDescription": "   Klarbrunn 12-PK 12 FL OZ  ",
      "price": "12.00"
    }
  ],
  "total": "35.35"
}
```
```text
Total Points: 28
Breakdown:
     6 points - retailer name has 6 characters
    10 points - 5 items (2 pairs @ 5 points each)
     3 Points - "Emils Cheese Pizza" is 18 characters (a multiple of 3)
                item price of 12.25 * 0.2 = 2.45, rounded up is 3 points
     3 Points - "Klarbrunn 12-PK 12 FL OZ" is 24 characters (a multiple of 3)
                item price of 12.00 * 0.2 = 2.4, rounded up is 3 points
     6 points - purchase day is odd
  + ---------
  = 28 points
```

----

```json
{
  "retailer": "M&M Corner Market",
  "purchaseDate": "2022-03-20",
  "purchaseTime": "14:33",
  "items": [
    {
      "shortDescription": "Gatorade",
      "price": "2.25"
    },{
      "shortDescription": "Gatorade",
      "price": "2.25"
    },{
      "shortDescription": "Gatorade",
      "price": "2.25"
    },{
      "shortDescription": "Gatorade",
      "price": "2.25"
    }
  ],
  "total": "9.00"
}
```
```text
Total Points: 109
Breakdown:
    50 points - total is a round dollar amount
    25 points - total is a multiple of 0.25
    14 points - retailer name (M&M Corner Market) has 14 alphanumeric characters
                note: '&' is not alphanumeric
    10 points - 2:33pm is between 2:00pm and 4:00pm
    10 points - 4 items (2 pairs @ 5 points each)
  + ---------
  = 109 points
```

---

# FAQ
## (From the original publication of this repository, left in case the reviewer needs this info.)

### How will this exercise be evaluated?
An engineer will review the code you submit. At a minimum they must be able to run the service and the service must provide the expected results. You
should provide any necessary documentation within the repository. While your solution does not need to be fully production ready, you are being evaluated so
put your best foot forward.

Part of that evaluation includes running an automated testing suite against your project to confirm it matches the specified API.

### I have questions about the problem statement
For any requirements not specified via an example, use your best judgment to determine the expected result.

### Can I provide a private repository?
If at all possible, we prefer a public repository because we do not know which engineer will be evaluating your submission. Providing a public repository
ensures a speedy review of your submission. If you are still uncomfortable providing a public repository, you can work with your recruiter to provide access to
the reviewing engineer.

### How long do I have to complete the exercise?
There is no time limit for the exercise. Out of respect for your time, we designed this exercise with the intent that it should take you a few hours. But, please
take as much time as you need to complete the work.
